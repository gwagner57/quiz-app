<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Collection Export</title>
  <link rel="stylesheet" type="text/css" href="https://raw.githack.com/gwagner57/quiz-app/main/docs/index.css?token=GHSAT0AAAAAACFSDHPJYZXMDVP7WIWLYBLWZIAWWSQ">
  <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>

<script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

</head>
<body>
  <div class="container">
    <h1>Select an item category:</h1>
    <select id="categoryDropdown">
      <option value="">Select a category</option>
    </select>
    <button id="generateButton">Generate HTML&JSON</button>
  </div>
  <script type="module">
// Your web app's Firebase configuration
const firebaseConfig = {

  apiKey: "AIzaSyBz2zzn-yN-Qn5lk5ds2QMoDSr_OzHTThw",

  authDomain: "quiz-app-9f2e2.firebaseapp.com",

  databaseURL: "https://quiz-app-9f2e2-default-rtdb.firebaseio.com",

  projectId: "quiz-app-9f2e2",

  storageBucket: "quiz-app-9f2e2.appspot.com",

  messagingSenderId: "708478453138",

  appId: "1:708478453138:web:46f5e6d25826cbd15ded4b"

}

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const collectionRef = db.collection('MoodleQuestions'); // Replace with your collection name

    collectionRef.get()
      .then((snapshot) => {
        const jsonData = [];
        snapshot.forEach((doc) => {
          jsonData.push(doc.data());
        });

        const categoryDropdown = document.getElementById('categoryDropdown');
        const categories = [...new Set(jsonData.map(item => item.category))]; // Get unique categories

        categories.forEach(category => {
          const option = document.createElement('option');
          option.value = category;
          option.textContent = category;
          categoryDropdown.appendChild(option);
        });
      
      
      
      
      
      
      })
      .catch((error) => {
        console.error('Error getting documents: ', error);
      });


let selectedQuestions = [];


    const categoryDropdown = document.getElementById('categoryDropdown');
    const generateButton = document.getElementById('generateButton');

    generateButton.addEventListener('click', () => {
      const selectedCategory = categoryDropdown.value;
      if (selectedCategory) {
        collectionRef.where('category', '==', selectedCategory).get(selectedQuestions)
          .then((snapshot) => {
            const categoryQuestions = [];
            snapshot.forEach((doc) => {
              categoryQuestions.push(doc.data());
            });

            const selectedQuestions = getRandomQuestions(categoryQuestions, 5);
            //console.log(selectedQuestions);
            const jsonString = JSON.stringify(selectedQuestions, null, 2);

            // Download the JSON file
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            //link.download = `${selectedCategory}_questions.json`;
            link.download = `quiz_questions.json`;
            link.click();












            async function generateHtml() {
            console.log(selectedQuestions);
            const jsonData2 = selectedQuestions;
            if (!jsonData2) {
            console.error('JSON data not available');
            return;
            }

            let html = `<!DOCTYPE html>
            <html lang="en">
            <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <link rel="stylesheet" type="text/css" href="Quiz.css">
              <title>quiz.title</title>
            </head>
            <body>
            <div class="container" id="container">
              <h1 id ="title">Quiz Title</h1>
              <script>
                 // Get the current URL
                const currentURL = window.location.href;

                  // Extract the file name from the URL
                  const fileName = currentURL.substring(currentURL.lastIndexOf('/')+1);
    
    
                    const fileNameWithoutExtension = fileName.substring(0, fileName.lastIndexOf('.'));


                     // Display the file name inside the <h1> element
                   const fileNameDisplay = document.getElementById("title");
                   fileNameDisplay.textContent =  fileNameWithoutExtension;
                <\/script>`;

            jsonData2.forEach((questionData, index) => {
            const type = questionData.type;
            const questionText = questionData.questiontext[0].value;
            html += `<div id=q${index}>\n`;
            html += `${questionText}`;
        //console.log(type);

            if (type === 'shortanswer') {
            html += `<input type="text" name='${questionData.name[0].value}' />\n`;
              } else if (type === 'multichoice') {
                const answers = questionData.answer;
                answers.forEach(answer => {
                  html += `<input type="checkbox" name='${questionData.name[0].value}' value='${answer.value}' /> ${answer.value}<br>\n`;
                  //console.log(answer.value);
                });
              } else if (type === 'gapfill'){
                html += `<input type="txt" name='${questionData.name[0].value}' /> \n`;
              }

              html += `</div>\n`;

            });
            html += `<div id="Submitd"><button id="Submit">Submit</button></div>
            <div id="results-container"></div>
            <script src="listener.js"><\/script>`;
            const blob2 = new Blob([html], { type: 'text/html' });
            const url2 = URL.createObjectURL(blob2);
            const link2 = document.createElement('a');
            link2.id = "test";
            link2.href = url2;
            link2.download = 'quiz_questions.html';
            link2.click();
          }



          generateHtml();

          
            //generateHtml();





















            
          })
          .catch((error) => {
            console.error('Error getting documents: ', error);
          });
      }
    });

    function getRandomQuestions(questions, count) {
  const shuffledQuestions = shuffleArray(questions); // Use a proper shuffle function
  return shuffledQuestions.slice(0, count);
}

// Fisher-Yates shuffle function
function shuffleArray(array) {
  const shuffledArray = array.slice(); // Create a copy of the array
  for (let i = shuffledArray.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffledArray[i], shuffledArray[j]] = [shuffledArray[j], shuffledArray[i]];
  }
  return shuffledArray;
}








</script>






</body>
</html>
